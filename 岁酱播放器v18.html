<html lang="zh-CN"><head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>岁酱播放器</title>
  <!-- 引入Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- 引入Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <!-- 配置Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#6366f1', // 主色调：靛蓝色
            secondary: '#ec4899', // 辅助色：粉色
            accent: '#8b5cf6', // 强调色：紫色
            dark: '#0f172a', // 深色背景
            'dark-light': '#1e293b', // 稍浅的深色，用于卡片
            light: '#f8fafc',
            'gray-custom': '#64748b' // 自定义灰色
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'glow': '0 0 15px rgba(99, 102, 241, 0.5)',
            'glow-secondary': '0 0 15px rgba(236, 72, 153, 0.5)',
            'level-1': '0 2px 8px rgba(0, 0, 0, 0.1)',
            'level-2': '0 4px 16px rgba(0, 0, 0, 0.15)',
            'level-3': '0 8px 24px rgba(0, 0, 0, 0.2)',
            'level-4': '0 12px 32px rgba(0, 0, 0, 0.25)',
          }
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .progress-thumb {
        @apply appearance-none w-5 h-5 rounded-full bg-white shadow-md cursor-pointer hover:scale-125 transition-all duration-300;
      }
      .progress-track {
        @apply appearance-none h-1.5 rounded-full bg-gray-300/30 dark:bg-gray-700/30;
      }
      .player-shadow {
        @apply shadow-level-2 hover:shadow-level-3 transition-all duration-500;
      }
      .btn-hover {
        @apply hover:scale-110 transition-transform duration-300;
      }
      .album-spin {
        animation: spin 20s linear infinite;
      }
      .lyric-gradient {
        background: linear-gradient(to bottom, rgba(15, 23, 42, 0) 0%, rgba(15, 23, 42, 0.8) 20%, rgba(15, 23, 42, 0.8) 80%, rgba(15, 23, 42, 0) 100%);
      }
      .lyric-active {
        @apply text-primary font-semibold scale-105 transition-all duration-300;
        text-shadow: 0 0 8px rgba(99, 102, 241, 0.5);
      }
      .pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }
      .float-effect {
        animation: float 6s ease-in-out infinite;
      }
      @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
        100% { transform: translateY(0px); }
      }
      .text-gradient {
        background-clip: text;
        -webkit-background-clip: text;
        color: transparent;
        background-image: linear-gradient(90deg, #6366f1, #ec4899, #8b5cf6);
        background-size: 200% auto;
        animation: textShine 3s linear infinite;
      }
      @keyframes textShine {
        to { background-position: 200% center; }
      }
      .lyric-fade-in {
        animation: fadeIn 0.5s ease-out forwards;
      }
      .lyric-fade-out {
        animation: fadeOut 0.5s ease-out forwards;
      }
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
      }
      @keyframes fadeOut {
        from { opacity: 1; transform: translateY(0); }
        to { opacity: 0.6; transform: translateY(-5px); }
      }
      .gradient-border {
        position: relative;
        border-radius: 1.5rem;
        z-index: 0;
      }
      .gradient-border::before {
        content: "";
        position: absolute;
        inset: -2px;
        z-index: -1;
        border-radius: 1.6rem;
        background: linear-gradient(135deg, #6366f1, #ec4899, #8b5cf6);
        opacity: 0.5;
        transition: all 0.5s ease;
        animation: border-animate 6s linear infinite;
        background-size: 300% 300%;
      }
      .gradient-border:hover::before {
        opacity: 0.8;
        filter: blur(2px);
      }
      @keyframes border-animate {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      .glass-effect {
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        background: rgba(30, 41, 59, 0.6);
      }
      /* 点击波纹效果 */
      .ripple {
        position: relative;
        overflow: hidden;
      }
      .ripple:after {
        content: "";
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        pointer-events: none;
        background-image: radial-gradient(circle, #fff 10%, transparent 10.01%);
        background-repeat: no-repeat;
        background-position: 50%;
        transform: scale(10, 10);
        opacity: 0;
        transition: transform .5s, opacity 0.8s;
      }
      .ripple:active:after {
        transform: scale(0, 0);
        opacity: .3;
        transition: 0s;
      }
      /* 列表项增强效果 */
      .playlist-item {
        @apply flex items-center p-2.5 rounded-lg hover:bg-primary/10 transition-all duration-300 cursor-pointer;
      }
      .playlist-item-active {
        @apply bg-primary/20 border border-primary/30;
      }
      /* 按钮点击效果 */
      .btn-click {
        @apply transform active:scale-95 transition-transform duration-150;
      }
      /* 粒子容器 */
      .particles-container {
        position: fixed;
        pointer-events: none;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 9999;
      }
      .particle {
        position: absolute;
        border-radius: 50%;
        pointer-events: none;
      }
      /* 滑动效果相关样式 */
      .slide-in {
        animation: slideIn 0.5s ease-out forwards;
      }
      .slide-out {
        animation: slideOut 0.5s ease-in forwards;
      }
      @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(20px); opacity: 0; }
      }
      .slide-in-right {
        animation: slideInRight 0.5s ease-out forwards;
      }
      @keyframes slideInRight {
        from { transform: translateX(20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      .bounce-in {
        animation: bounceIn 0.6s cubic-bezier(0.215, 0.610, 0.355, 1.000) forwards;
      }
      @keyframes bounceIn {
        0% { transform: scale(0.3); opacity: 0; }
        20% { transform: scale(1.1); }
        40% { transform: scale(0.9); }
        60% { transform: scale(1.03); opacity: 1; }
        80% { transform: scale(0.97); }
        100% { transform: scale(1); opacity: 1; }
      }
      /* 歌词动画 - 平滑向上滚动效果 */
      .lyric-slide-up {
        animation: slideUp 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
      }
      .lyric-slide-down {
        animation: slideDown 0.6s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
      }
      @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }
      @keyframes slideDown {
        from { transform: translateY(0); opacity: 1; }
        to { transform: translateY(-20px); opacity: 0.5; }
      }
      .album-hover {
        transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      }
      .album-hover:hover {
        transform: translateY(-10px) scale(1.02);
      }
      .scroll-smooth {
        scroll-behavior: smooth;
      }
      /* 进度条美化 - 添加走过的路径效果 */
      .progress-container {
        position: relative;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background-color: rgba(255, 255, 255, 0.1);
      }
      .progress-filled {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        border-radius: 3px;
        background: linear-gradient(90deg, #6366f1, #8b5cf6);
        transition: width 0.3s ease;
        z-index: 1;
      }
      .progress-handle {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background-color: white;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        z-index: 2;
        transition: all 0.15s ease;
      }
      .progress-handle:hover {
        transform: translateY(-50%) scale(1.2);
        box-shadow: 0 0 8px rgba(99, 102, 241, 0.7);
      }
      .progress-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
        z-index: 3;
      }
      /* 音量滑块样式 */
      input[type="range"].volume-slider {
        -webkit-appearance: none;
        width: 100%;
        height: 6px;
        border-radius: 3px;
        background: rgba(255, 255, 255, 0.1);
        outline: none;
      }
      input[type="range"].volume-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: white;
        cursor: pointer;
        transition: all 0.15s ease;
      }
      input[type="range"].volume-slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 0 8px rgba(236, 72, 153, 0.7);
      }
      /* 自定义滚动条 */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(99, 102, 241, 0.5);
        border-radius: 10px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.8);
      }
      /* 层次效果增强 */
      .z-1 { z-index: 10; }
      .z-2 { z-index: 20; }
      .z-3 { z-index: 30; }
      .z-4 { z-index: 40; }
      .z-5 { z-index: 50; }
      .depth-1 { transform: translateY(2px); }
      .depth-2 { transform: translateY(4px); }
      .hover-lift { transition: transform 0.3s ease, box-shadow 0.3s ease; }
      .hover-lift:hover { transform: translateY(-2px); }
      /* 颜文字样式 */
      .emoji-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
        padding: 8px 12px;
        border-radius: 20px;
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        font-size: 1.2rem;
        transition: all 0.5s ease;
        opacity: 0.8;
      }
      .emoji-container:hover {
        opacity: 1;
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }
      .emoji-fade-in {
        animation: emojiFadeIn 0.5s ease-out forwards;
      }
      .emoji-fade-out {
        animation: emojiFadeOut 0.5s ease-in forwards;
      }
      @keyframes emojiFadeIn {
        from { opacity: 0; transform: translate(10px, 10px); }
        to { opacity: 0.8; transform: translate(0, 0); }
      }
      @keyframes emojiFadeOut {
        from { opacity: 0.8; transform: translate(0, 0); }
        to { opacity: 0; transform: translate(10px, 10px); }
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-dark via-slate-900 to-slate-800 min-h-screen font-inter text-light p-4 antialiased">
  <!-- 背景装饰元素 - 增加深度感 -->
  <div class="fixed inset-0 overflow-hidden pointer-events-none z-0">
    <div class="absolute -top-40 -right-40 w-96 h-96 bg-primary/10 rounded-full blur-3xl"></div>
    <div class="absolute top-1/3 -left-20 w-64 h-64 bg-secondary/10 rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-1/4 w-80 h-80 bg-accent/10 rounded-full blur-3xl"></div>
    <!-- 网格背景增加深度 -->
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxnIGZpbGw9IiMyMDIwMjAiIGZpbGwtb3BhY2l0eT0iMC4wNSI+PHBhdGggZD0iTTEgMUg1OU0xIDExSDU5TTExIDFIMTU1TTExIDExSDE1NSIvPjwvZz48L2c+PC9zdmc+')] opacity-20"></div>
  </div>
  
  <!-- 粒子效果容器 -->
  <div class="particles-container" id="particlesContainer"></div>
  
  <!-- 右下角随机颜文字容器 -->
  <div class="emoji-container emoji-fade-in" id="emojiContainer">
    (≧∇≦)ﾉ
  </div>
  
  <div class="max-w-6xl mx-auto w-full relative z-10">
    <!-- 标题和导入按钮区域 - 左侧按钮，中间标题，右侧按钮 -->
    <div class="mb-8 flex flex-col md:flex-row items-center justify-between relative">
      <!-- 背景装饰增加层次感 -->
      <div class="absolute inset-0 bg-gradient-to-r from-primary/5 to-accent/5 to-secondary/5 rounded-3xl blur-xl -z-10"></div>
      
      <!-- 左侧：导入本地音乐按钮 -->
      <label for="audioImport" class="bg-gradient-to-r from-primary to-accent hover:from-primary/90 hover:to-accent/90 text-white py-2.5 px-6 rounded-full inline-flex items-center cursor-pointer transition-all btn-hover shadow-glow shadow-primary/20 ripple btn-click particle-trigger slide-in mb-4 md:mb-0 hover-lift z-1">
        <i class="fa fa-upload mr-2"></i>导入本地音乐
        <input type="file" id="audioImport" accept="audio/*" multiple="" class="hidden">
      </label>
      
      <!-- 中间：标题 -->
      <div class="text-center bounce-in relative z-2">
        <h1 class="text-[clamp(2rem,5vw,3.5rem)] font-bold text-gradient tracking-wide">岁酱播放器</h1>
        <!-- 装饰元素增强层次感 -->
        <div class="absolute -top-2 left-1/2 transform -translate-x-1/2 w-3/4 h-1 bg-gradient-to-r from-transparent via-primary/50 to-transparent"></div>
        <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-2/3 h-1 bg-gradient-to-r from-transparent via-secondary/50 to-transparent"></div>
        <!-- 光晕效果增强标题层次 -->
        <div class="absolute inset-0 bg-gradient-to-r from-primary/20 via-accent/20 to-secondary/20 rounded-full blur-2xl opacity-30 -z-10"></div>
      </div>
      
      <!-- 右侧：导入歌词按钮 -->
      <label for="lyricImport" class="bg-gradient-to-r from-secondary to-accent hover:from-secondary/90 hover:to-accent/90 text-white py-2.5 px-6 rounded-full inline-flex items-center cursor-pointer transition-all btn-hover shadow-glow-secondary shadow-secondary/20 ripple btn-click particle-trigger slide-in-right mb-4 md:mb-0 hover-lift z-1">
        <i class="fa fa-file-text-o mr-2"></i>导入歌词
        <input type="file" id="lyricImport" accept=".lrc,.txt" class="hidden">
      </label>
    </div>
    
    <div class="flex flex-col lg:flex-row gap-6">
      <!-- 左侧：播放器主体 - 增加深度和层次 -->
      <div class="lg:w-2/3 slide-in" style="animation-delay: 0.1s">
        <!-- 音乐播放器容器 - 增加多层次阴影和深度 -->
        <div class="gradient-border glass-effect rounded-2xl p-6 player-shadow border border-white/10 h-full relative z-1 hover-lift">
          <!-- 内阴影增加容器内部深度 -->
          <div class="absolute inset-0 bg-gradient-to-b from-dark/20 to-dark-light/20 rounded-2xl pointer-events-none -z-10"></div>
          
          <!-- 专辑封面和歌曲信息（横屏时并排显示） -->
          <div class="flex flex-col sm:flex-row gap-6 mb-6">
            <!-- 专辑封面 - 突出显示在最上层 -->
            <div class="relative rounded-xl overflow-hidden group sm:w-1/3 md:w-1/4 shadow-level-4 border-2 border-white/10 cursor-pointer ripple btn-click particle-trigger album-hover z-2" id="albumCoverContainer">
              <div class="absolute inset-0 bg-gradient-to-r from-primary/20 to-secondary/20 rounded-xl"></div>
              <img id="albumCover" src="https://p3-flow-imagex-sign.byteimg.com/tos-cn-i-a9rns2rl98/rc/pc/code_assistant/82e83a73cbda471383dc50b3e2c2b278~tplv-a9rns2rl98-image.image?rk3s=8e244e95&amp;rrcfp=e75484ac&amp;x-expires=1754122500&amp;x-signature=xXeX8%2FyLZ6FStLdcut8pWK7B3qQ%3D" alt="默认专辑封面" class="w-full aspect-square object-cover transition-transform duration-700 group-hover:scale-110">
              <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                <div class="w-16 h-16 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center shadow-lg">
                  <i class="fa fa-play text-white text-xl"></i>
                </div>
              </div>
              <!-- 装饰圆环增强深度 -->
              <div class="absolute inset-0 rounded-full border-2 border-dashed border-white/20 animate-spin" style="animation-duration: 40s;"></div>
              <div class="absolute inset-[10px] rounded-full border border-white/10"></div>
              <!-- 底部阴影增加悬浮感 -->
              <div class="absolute -bottom-4 left-1/2 transform -translate-x-1/2 w-3/4 h-2 bg-primary/30 rounded-full blur-xl"></div>
            </div>
            
            <!-- 歌曲信息 - 层次低于专辑封面 -->
            <div class="flex-1 flex flex-col justify-center relative z-1">
              <h2 class="text-2xl md:text-3xl font-bold truncate text-white transition-all duration-500 hover:translate-x-1" id="songTitle">没有歌呀(╥_╥)</h2>
              <p class="text-gray-300 mt-2 transition-all duration-500 hover:translate-x-1" id="songArtist">现在是岁酱时间</p>
              
              <!-- 播放模式显示（横屏时位置调整） -->
              <div class="mt-4 text-sm text-gray-400 flex items-center bg-dark-light/30 px-3 py-1.5 rounded-full w-fit backdrop-blur-sm">
                <i class="fa fa-list mr-2" id="modeIcon"></i>
                <span id="modeText">顺序播放</span>
              </div>
            </div>
          </div>
          
          <!-- 歌词显示区域 - 增加内阴影和边框层次 -->
          <div class="relative rounded-xl overflow-hidden mb-6 h-72 bg-gradient-to-b from-dark/70 via-dark-light/80 to-dark/70 border border-white/10 shadow-inner z-1">
            <!-- 上下渐变遮罩增强深度感 -->
            <div class="absolute top-0 left-0 right-0 h-20 lyric-gradient pointer-events-none"></div>
            <div class="absolute bottom-0 left-0 right-0 h-20 lyric-gradient pointer-events-none transform rotate-180"></div>
            
            <div class="absolute top-2 left-2 text-xs text-gray-500 z-10">
              <i class="fa fa-music mr-1"></i>歌词(˵¯͒〰¯͒˵)
            </div>
            
            <!-- 歌词容器 - 采用主流音乐软件的歌词显示效果，宽度减小到原来的三分之二并保持居中 -->
            <div id="lyricContainer" class="flex flex-col items-center h-full text-center overflow-y-auto py-6 px-4 text-base scroll-smooth w-[66.666%] mx-auto">
        <div class="text-gray-500 space-y-2">
          <i class="fa fa-file-text-o text-2xl mb-2 block text-gray-600"></i>
          <p>暂无歌词</p>
          <p class="text-xs mt-1 text-gray-600">请为当前歌曲导入LRC歌词文件</p>
        </div>
      </div>
          </div>
          
          <!-- 进度条 - 带走过的路径效果 -->
          <div class="mb-6 px-1 relative z-1">
            <div class="flex justify-between text-xs text-gray-400 mb-2">
              <span id="currentTime" class="transition-colors hover:text-primary">00:06</span>
              <span id="totalTime" class="transition-colors hover:text-primary">04:17</span>
            </div>
            <div class="progress-container particle-trigger">
              <div class="progress-filled" id="progressFilled" style="width: 2.51422%;"></div>
              <div class="progress-handle" id="progressHandle" style="left: 18.731px;"></div>
              <input type="range" id="progressBar" min="0" max="100" value="0" class="progress-input">
            </div>
          </div>
          
          <!-- 音量控制 -->
          <div class="mb-6 px-2 relative z-1">
            <div class="flex items-center space-x-2">
              <i class="fa fa-volume-up text-gray-400 w-5 cursor-pointer particle-trigger transition-colors hover:text-secondary" id="volumeIcon"></i>
              <input type="range" id="volumeSlider" min="0" max="100" value="80" class="volume-slider accent-secondary cursor-pointer particle-trigger">
            </div>
          </div>
          
          <!-- 控制按钮 - 播放按钮突出显示在最上层 -->
          <div class="flex items-center justify-between mt-4 relative z-1">
            <!-- 播放模式 -->
            <button id="modeButton" class="text-gray-400 hover:text-accent btn-hover ripple btn-click particle-trigger transition-colors hover-lift" aria-label="顺序播放"><i class="fa fa-list text-xl"></i></button>
            
            <!-- 上一首 -->
            <button id="prevButton" class="text-gray-300 hover:text-primary btn-hover ripple btn-click particle-trigger transition-colors hover-lift">
              <i class="fa fa-step-backward text-2xl"></i>
            </button>
            
            <!-- 播放/暂停 - 最高层级突出显示 -->
            <button id="playPauseButton" class="w-16 h-16 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center text-white btn-hover shadow-glow shadow-primary/30 ripple btn-click particle-trigger pulse-slow relative z-2 hover-lift">
              <i class="fa fa-play text-2xl"></i>
            </button>
            
            <!-- 下一首 -->
            <button id="nextButton" class="text-gray-300 hover:text-primary btn-hover ripple btn-click particle-trigger transition-colors hover-lift">
              <i class="fa fa-step-forward text-2xl"></i>
            </button>
            
            <!-- 静音按钮 -->
            <button id="muteButton" class="text-gray-400 hover:text-secondary btn-hover ripple btn-click particle-trigger transition-colors hover-lift"><i class="fa fa-volume-up text-xl"></i></button>
          </div>
        </div>
      </div>
      
      <!-- 右侧：播放列表 - 层次稍低于主播放器 -->
      <div class="lg:w-1/3 slide-in" style="animation-delay: 0.2s">
        <div class="glass-effect rounded-xl p-4 player-shadow border border-white/10 h-full relative z-1 hover-lift">
          <!-- 内阴影增加深度 -->
          <div class="absolute inset-0 bg-gradient-to-b from-dark/10 to-dark-light/10 rounded-xl pointer-events-none -z-10"></div>
          
          <h3 class="text-sm font-semibold mb-3 text-gray-200 flex items-center">
            <i class="fa fa-list-ul mr-2 text-accent"></i>播放列表
            <span id="localFilesIndicator" class="ml-2 text-xs bg-secondary/20 text-secondary px-2 py-0.5 rounded-full">
              包含本地文件
            </span>
          </h3>
          <ul id="playlist" class="space-y-2 max-h-[320px] sm:max-h-[400px] overflow-y-auto pr-2 scroll-smooth">
            <li class="playlist-item playlist-item-active slide-in relative hover-lift" style="animation-delay: 0ms;">
              <div class="absolute inset-0 bg-primary/5 rounded-lg -z-10"></div>
              <div class="w-8 text-center mr-2 text-gray-400">
                <i class="fa fa-music text-primary"></i>
              </div>
              <div class="flex-1 min-w-0">
                <div class="truncate font-medium">这没有音乐ಠ~ಠ </div>
                <div class="truncate text-xs text-gray-400">岁酱表示很抱歉(｡í _ ì｡)</div>
              </div>
              <button class="delete-song text-gray-500 hover:text-secondary p-1 ml-2 opacity-0 hover:opacity-100 transition-opacity" data-index="0">
                <i class="fa fa-times"></i>
              </button>
            </li>
          </ul>
        </div>
      </div>
    </div>
    
    <!-- 底部信息 - 置于最底层 -->
    <div class="mt-6 text-center text-xs text-gray-500 slide-in" style="animation-delay: 0.3s">
      <p>岁酱播放器 © 2025 | 支持本地音乐播放｜(ꐦÒ‸Ó)你个老六</p>
    </div>
  </div>
  
  <!-- 音频元素 -->
  <audio id="audioPlayer" preload="metadata">
   您的浏览器不支持音频播放
  </audio>

  <script>
    // 粒子效果实现
    const particlesContainer = document.getElementById('particlesContainer');
    
    // 生成随机颜色，基于主题色
    function getRandomColor() {
      const colors = [
        '#6366f1', // primary
        '#ec4899', // secondary
        '#8b5cf6', // accent
        '#a78bfa', // light accent
        '#f472b6', // light secondary
        '#818cf8', // light primary
      ];
      return colors[Math.floor(Math.random() * colors.length)];
    }
    
    // 创建粒子
    function createParticles(x, y, count = 8) {
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // 随机大小
        const size = Math.random() * 8 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // 随机颜色
        particle.style.backgroundColor = getRandomColor();
        
        // 位置
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        
        // 随机动画
        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * 40 + 20;
        const duration = Math.random() * 800 + 600;
        
        // 添加到容器
        particlesContainer.appendChild(particle);
        
        // 动画
        setTimeout(() => {
          const endX = x + Math.cos(angle) * distance;
          const endY = y + Math.sin(angle) * distance;
          
          particle.style.transition = `all ${duration}ms ease-out`;
          particle.style.transform = `translate(${endX - x}px, ${endY - y}px)`;
          particle.style.opacity = '0';
          
          // 动画结束后移除
          setTimeout(() => {
            if (particlesContainer.contains(particle)) {
              particlesContainer.removeChild(particle);
            }
          }, duration);
        }, 10);
      }
    }
    
    // 为所有带particle-trigger类的元素添加粒子效果
    document.querySelectorAll('.particle-trigger').forEach(element => {
      element.addEventListener('click', (e) => {
        // 获取点击位置（相对于视口）
        const rect = element.getBoundingClientRect();
        const x = e.clientX;
        const y = e.clientY;
        
        // 创建粒子
        createParticles(x, y);
      });
    });
    
    // 播放列表项点击添加粒子效果
    const playlist = document.getElementById('playlist');
    playlist.addEventListener('click', (e) => {
      const listItem = e.target.closest('li.playlist-item');
      if (listItem) {
        const rect = listItem.getBoundingClientRect();
        const x = e.clientX;
        const y = e.clientY;
        createParticles(x, y, 5);
      }
    });
    
    // 标题悬停效果
    const titleElement = document.querySelector('h1');
    titleElement.addEventListener('mouseenter', () => {
      // 在标题周围创建一些装饰粒子
      const rect = titleElement.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      
      // 围绕标题创建粒子
      for (let i = 0; i < 12; i++) {
        const angle = (i / 12) * Math.PI * 2;
        const distance = rect.width / 2 + 10;
        const x = centerX + Math.cos(angle) * distance;
        const y = centerY + Math.sin(angle) * distance;
        
        setTimeout(() => {
          createParticles(x, y, 1);
        }, i * 100);
      }
    });
    
    // 添加滑动粒子效果 - 跟踪手指/鼠标滑动轨迹
    let isDraggingScreen = false;
    let lastSlideTime = 0;
    const SLIDE_PARTICLE_INTERVAL = 50; // 粒子生成间隔(ms)
    
    // 鼠标滑动事件
    document.addEventListener('mousedown', (e) => {
      isDraggingScreen = true;
    });
    
    document.addEventListener('mousemove', (e) => {
      if (isDraggingScreen) {
        const now = Date.now();
        // 控制粒子生成频率，避免过多粒子影响性能
        if (now - lastSlideTime > SLIDE_PARTICLE_INTERVAL) {
          lastSlideTime = now;
          // 滑动时生成较少的粒子，形成轨迹效果
          createParticles(e.clientX, e.clientY, 2);
        }
      }
    });
    
    document.addEventListener('mouseup', () => {
      isDraggingScreen = false;
    });
    
    document.addEventListener('mouseleave', () => {
      isDraggingScreen = false;
    });
    
    // 触摸滑动事件（移动设备）
    document.addEventListener('touchstart', (e) => {
      isDraggingScreen = true;
      // 触摸开始时也生成一个粒子
      if (e.touches.length > 0) {
        createParticles(e.touches[0].clientX, e.touches[0].clientY, 3);
      }
    }, { passive: true });
    
    document.addEventListener('touchmove', (e) => {
      if (isDraggingScreen && e.touches.length > 0) {
        const now = Date.now();
        if (now - lastSlideTime > SLIDE_PARTICLE_INTERVAL) {
          lastSlideTime = now;
          // 触摸滑动时生成粒子
          createParticles(e.touches[0].clientX, e.touches[0].clientY, 2);
        }
      }
    }, { passive: true });
    
    document.addEventListener('touchend', () => {
      isDraggingScreen = false;
    });
    
    document.addEventListener('touchcancel', () => {
      isDraggingScreen = false;
    });
    
    // 随机颜文字功能
    const emojiContainer = document.getElementById('emojiContainer');
    const emojis = [
      '(≧∇≦)ﾉ', '(*≧ω≦)', '(*^▽^*)', '(≧∀≦)ゞ', 'φ(≧ω≦*)♪', 
      '(๑＞ڡ＜)☆', '(*^▽^*)', '(≧∇≦)/', 'ヾ(≧▽≦*)o', 'ヽ(✿ﾟ▽ﾟ)ノ',
      '(≧∇≦)ﾉ', 'o(≧v≦)o', 'ヾ(◍°∇°◍)ﾉﾞ', '(๑•̀ㅂ•́)و✧', 'ψ(｀∇´)ψ'
    ];
    
    // 切换颜文字的函数
    function changeEmoji() {
      // 添加淡出动画
      emojiContainer.classList.remove('emoji-fade-in');
      emojiContainer.classList.add('emoji-fade-out');
      
      // 动画结束后更换颜文字并添加淡入动画
      setTimeout(() => {
        const randomIndex = Math.floor(Math.random() * emojis.length);
        emojiContainer.textContent = emojis[randomIndex];
        
        // 移除淡出动画，添加淡入动画
        emojiContainer.classList.remove('emoji-fade-out');
        emojiContainer.classList.add('emoji-fade-in');
      }, 500);
    }
    
    // 定时更换颜文字（每5-10秒随机更换一次）
    function scheduleEmojiChange() {
      const interval = Math.random() * 5000 + 5000; // 5-10秒
      setTimeout(() => {
        changeEmoji();
        scheduleEmojiChange(); // 循环调度
      }, interval);
    }
    
    // 点击颜文字也会更换
    emojiContainer.addEventListener('click', changeEmoji);
    
    // 启动颜文字定时更换
    scheduleEmojiChange();
    
    // 音乐播放器核心功能
    // 获取DOM元素
    const audioPlayer = document.getElementById('audioPlayer');
    const playPauseButton = document.getElementById('playPauseButton');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const progressBar = document.getElementById('progressBar');
    const progressFilled = document.getElementById('progressFilled');
    const progressHandle = document.getElementById('progressHandle');
    const currentTimeDisplay = document.getElementById('currentTime');
    const totalTimeDisplay = document.getElementById('totalTime');
    const modeButton = document.getElementById('modeButton');
    const modeText = document.getElementById('modeText');
    const modeIcon = document.getElementById('modeIcon');
    const muteButton = document.getElementById('muteButton');
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeIcon = document.getElementById('volumeIcon');
    const songTitle = document.getElementById('songTitle');
    const songArtist = document.getElementById('songArtist');
    const albumCover = document.getElementById('albumCover');
    const albumCoverContainer = document.getElementById('albumCoverContainer');
    const audioImport = document.getElementById('audioImport');
    const lyricImport = document.getElementById('lyricImport');
    const lyricContainer = document.getElementById('lyricContainer');
    const localFilesIndicator = document.getElementById('localFilesIndicator');
    
    // 播放模式: 0-顺序播放, 1-单曲循环, 2-随机播放
    let playMode = 0;
    // 当前播放索引
    let currentIndex = -1;
    // 是否正在拖动进度条
    let isDragging = false;
    // 是否有本地文件
    let hasLocalFiles = false;
    // 保存原始音量，用于静音时恢复
    let originalVolume = 0.8;
    // 歌词数据
    let lyrics = [];
    // 当前歌词索引
    let currentLyricIndex = -1;
    // 歌词行高，用于精确计算滚动位置
    const lyricLineHeight = 36; // 约等于py-2的高度
    // 歌词DOM缓存，避免频繁创建
    let lyricElements = [];
    // 歌词更新节流控制
    let lastLyricUpdateTime = 0;
    const LYRIC_UPDATE_INTERVAL = 50; // 歌词更新最小间隔(ms)
    // 记录上一次滚动位置，用于平滑过渡
    let lastScrollTop = 0;
    
    // 歌曲列表数据 - 仅包含本地导入的歌曲
    const songs = [];
    
    // 格式化时间（秒 -> mm:ss）
    function formatTime(seconds) {
      if (isNaN(seconds)) return '00:00';
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
    
    // 更新进度条和歌词 - 包含走过的路径效果
    function updateProgress() {
      if (!isDragging && !isNaN(audioPlayer.duration)) {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        // 更新进度条填充部分（走过的路径）
        progressFilled.style.width = `${progress}%`;
        // 更新滑块位置
        const containerWidth = progressBar.parentElement.clientWidth;
        const handlePosition = (progress / 100) * containerWidth;
        progressHandle.style.left = `${handlePosition}px`;
        // 更新进度条输入值
        progressBar.value = progress;
        
        currentTimeDisplay.textContent = formatTime(audioPlayer.currentTime);
        
        // 控制歌词更新频率，避免过于频繁
        const now = Date.now();
        if (now - lastLyricUpdateTime > LYRIC_UPDATE_INTERVAL) {
          lastLyricUpdateTime = now;
          updateLyrics(audioPlayer.currentTime);
        }
      }
    }
    
    // 更新总时间
    function updateTotalTime() {
      if (!isNaN(audioPlayer.duration)) {
        totalTimeDisplay.textContent = formatTime(audioPlayer.duration);
      }
    }
    
    // 切换播放/暂停
    function togglePlayPause() {
      if (audioPlayer.paused) {
        audioPlayer.play();
        playPauseButton.innerHTML = '<i class="fa fa-pause text-2xl"></i>';
        albumCover.classList.add('album-spin');
        // 添加播放按钮脉动效果
        playPauseButton.classList.add('animate-pulse');
        setTimeout(() => playPauseButton.classList.remove('animate-pulse'), 1000);
      } else {
        audioPlayer.pause();
        playPauseButton.innerHTML = '<i class="fa fa-play text-2xl"></i>';
        albumCover.classList.remove('album-spin');
      }
    }
    
    // 切换播放模式
    function togglePlayMode() {
      playMode = (playMode + 1) % 3;
      updateModeUI();
      
      // 添加模式切换的滑动动画
      modeButton.classList.add('slide-in');
      setTimeout(() => {
        modeButton.classList.remove('slide-in');
      }, 500);
    }
    
    // 更新播放模式UI
    function updateModeUI() {
      switch(playMode) {
        case 0: // 顺序播放
          modeButton.innerHTML = '<i class="fa fa-list text-xl"></i>';
          modeIcon.className = 'fa fa-list mr-2';
          modeButton.setAttribute('aria-label', '顺序播放');
          modeText.textContent = '顺序播放';
          break;
        case 1: // 单曲循环
          modeButton.innerHTML = '<i class="fa fa-repeat text-xl"></i>';
          modeIcon.className = 'fa fa-repeat mr-2';
          modeButton.setAttribute('aria-label', '单曲循环');
          modeText.textContent = '单曲循环';
          break;
        case 2: // 随机播放
          modeButton.innerHTML = '<i class="fa fa-random text-xl"></i>';
          modeIcon.className = 'fa fa-random mr-2';
          modeButton.setAttribute('aria-label', '随机播放');
          modeText.textContent = '随机播放';
          break;
      }
    }
    
    // 切换静音
    function toggleMute() {
      if (audioPlayer.muted) {
        // 取消静音
        audioPlayer.muted = false;
        volumeSlider.value = originalVolume * 100;
        updateVolumeIcon();
      } else {
        // 静音
        originalVolume = audioPlayer.volume;
        audioPlayer.muted = true;
        volumeSlider.value = 0;
        updateVolumeIcon();
      }
      
      // 音量图标滑动效果
      volumeIcon.classList.add('slide-in');
      setTimeout(() => {
        volumeIcon.classList.remove('slide-in');
      }, 300);
    }
    
    // 更新音量图标
    function updateVolumeIcon() {
      const volume = audioPlayer.muted ? 0 : volumeSlider.value;
      
      if (volume == 0) {
        volumeIcon.className = 'fa fa-volume-off text-gray-400 w-5 cursor-pointer particle-trigger transition-colors hover:text-secondary';
        muteButton.innerHTML = '<i class="fa fa-volume-off text-xl"></i>';
      } else if (volume < 50) {
        volumeIcon.className = 'fa fa-volume-down text-gray-400 w-5 cursor-pointer particle-trigger transition-colors hover:text-secondary';
        muteButton.innerHTML = '<i class="fa fa-volume-down text-xl"></i>';
      } else {
        volumeIcon.className = 'fa fa-volume-up text-gray-400 w-5 cursor-pointer particle-trigger transition-colors hover:text-secondary';
        muteButton.innerHTML = '<i class="fa fa-volume-up text-xl"></i>';
      }
    }
    
    // 更新音量
    function updateVolume() {
      const volume = volumeSlider.value / 100;
      audioPlayer.volume = volume;
      if (volume > 0 && audioPlayer.muted) {
        audioPlayer.muted = false;
      }
      updateVolumeIcon();
    }
    
    // 跳转到指定进度
    function seekTo() {
      if (isNaN(audioPlayer.duration)) return;
      const seekTime = (progressBar.value / 100) * audioPlayer.duration;
      audioPlayer.currentTime = seekTime;
      // 立即更新歌词，不等待节流
      updateLyrics(seekTime);
      
      // 更新进度条UI
      const progress = progressBar.value;
      progressFilled.style.width = `${progress}%`;
      const containerWidth = progressBar.parentElement.clientWidth;
      const handlePosition = (progress / 100) * containerWidth;
      progressHandle.style.left = `${handlePosition}px`;
    }
    
    // 处理进度条拖动开始
    function handleProgressDragStart() {
      isDragging = true;
      progressFilled.style.transition = 'none';
      progressHandle.style.transition = 'none';
    }
    
    // 处理进度条拖动中
    function handleProgressDragging() {
      if (isDragging) {
        const progress = progressBar.value;
        progressFilled.style.width = `${progress}%`;
        const containerWidth = progressBar.parentElement.clientWidth;
        const handlePosition = (progress / 100) * containerWidth;
        progressHandle.style.left = `${handlePosition}px`;
      }
    }
    
    // 处理进度条拖动结束
    function handleProgressDragEnd() {
      if (isDragging) {
        isDragging = false;
        progressFilled.style.transition = 'width 0.3s ease';
        progressHandle.style.transition = 'left 0.3s ease';
        seekTo();
      }
    }
    
    // 加载并播放指定索引的歌曲
    function loadAndPlay(index) {
      if (index < 0 || index >= songs.length) return;
      
      // 移除当前歌曲的活动状态并添加滑出效果
      if (currentIndex !== -1) {
        const currentItem = playlist.children[currentIndex];
        if (currentItem) {
          currentItem.classList.remove('playlist-item-active');
          currentItem.classList.add('slide-out');
        }
      }
      
      currentIndex = index;
      const song = songs[index];
      
      // 更新歌曲信息并添加滑入效果
      songTitle.textContent = song.title || '未知歌曲';
      songArtist.textContent = song.artist || '未知艺术家';
      songTitle.classList.add('slide-in');
      songArtist.classList.add('slide-in');
      
      setTimeout(() => {
        songTitle.classList.remove('slide-in');
        songArtist.classList.remove('slide-in');
      }, 500);
      
      // 更新音频源
      audioPlayer.src = song.url;
      audioPlayer.load();
      audioPlayer.play().then(() => {
        playPauseButton.innerHTML = '<i class="fa fa-pause text-2xl"></i>';
        albumCover.classList.add('album-spin');
        updatePlaylistUI();
      }).catch(error => {
        console.error('播放失败:', error);
        alert('无法播放此音频文件');
      });
      
      // 加载对应歌词
      loadLyricsForCurrentSong();
    }
    
    // 播放上一首
    function playPrevious() {
      if (songs.length === 0) return;
      
      let newIndex;
      if (playMode === 2) { // 随机播放模式
        newIndex = getRandomIndex();
      } else { // 顺序或单曲循环模式
        newIndex = currentIndex - 1;
        if (newIndex < 0) newIndex = songs.length - 1;
      }
      
      loadAndPlay(newIndex);
    }
    
    // 播放下一首
    function playNext() {
      if (songs.length === 0) return;
      
      let newIndex;
      if (playMode === 2) { // 随机播放模式
        newIndex = getRandomIndex();
      } else { // 顺序或单曲循环模式
        newIndex = currentIndex + 1;
        if (newIndex >= songs.length) newIndex = 0;
      }
      
      loadAndPlay(newIndex);
    }
    
    // 获取随机索引（与当前不同）
    function getRandomIndex() {
      if (songs.length <= 1) return 0;
      
      let randomIndex;
      do {
        randomIndex = Math.floor(Math.random() * songs.length);
      } while (randomIndex === currentIndex);
      
      return randomIndex;
    }
    
    // 解析LRC歌词
    function parseLyrics(lrcText) {
      const lyricLines = lrcText.split('\n');
      const parsedLyrics = [];
      
      // 匹配时间标签的正则表达式
      const timeRegex = /\[(\d{2}):(\d{2})\.(\d{2,3})\]/;
      
      for (const line of lyricLines) {
        const match = timeRegex.exec(line);
        if (match) {
          // 解析时间（分:秒.毫秒）
          const minutes = parseInt(match[1], 10);
          const seconds = parseInt(match[2], 10);
          const milliseconds = match[3].length === 3 ? 
            parseInt(match[3], 10) : 
            parseInt(match[3], 10) * 10; // 处理两位数毫秒
          
          const timeInSeconds = minutes * 60 + seconds + milliseconds / 1000;
          
          // 获取歌词文本
          const text = line.replace(timeRegex, '').trim();
          
          if (text) {
            parsedLyrics.push({ time: timeInSeconds, text });
          }
        }
      }
      
      // 按时间排序
      return parsedLyrics.sort((a, b) => a.time - b.time);
    }
    
    // 使用二分查找优化歌词索引查找
    function findLyricIndex(currentTime) {
      if (lyrics.length === 0) return -1;
      
      let low = 0;
      let high = lyrics.length - 1;
      let result = -1;
      
      while (low <= high) {
        const mid = Math.floor((low + high) / 2);
        if (lyrics[mid].time <= currentTime) {
          result = mid;
          low = mid + 1;
        } else {
          high = mid - 1;
        }
      }
      
      return result;
    }
    
    // 更新歌词显示 - 与主流音乐软件一致的效果
    function updateLyrics(currentTime) {
      if (lyrics.length === 0) return;
      
      // 使用二分查找高效找到当前歌词索引
      const newIndex = findLyricIndex(currentTime);
      
      // 只有当歌词索引变化时才更新
      if (newIndex !== currentLyricIndex && newIndex >= 0) {
        // 记录索引变化方向，用于优化动画
        const isMovingForward = newIndex > currentLyricIndex;
        currentLyricIndex = newIndex;
        // 使用requestAnimationFrame确保动画平滑
        requestAnimationFrame(() => renderLyrics(isMovingForward));
      }
    }
    
    // 渲染歌词 - 实现主流音乐软件的歌词效果
    function renderLyrics(isMovingForward) {
      // 仅在歌词容器存在时执行
      if (!lyricContainer) return;
      
      // 复用DOM元素，避免频繁创建和销毁
      if (lyricElements.length !== lyrics.length) {
        // 清空容器并重建DOM缓存
        lyricContainer.innerHTML = '';
        lyricElements = [];
        
        lyrics.forEach((lyric, index) => {
          const lyricElement = document.createElement('div');
          lyricElement.className = 'py-2 px-4 transition-all duration-300';
          lyricElement.textContent = lyric.text;
          lyricContainer.appendChild(lyricElement);
          lyricElements.push(lyricElement);
        });
      }
      
      // 更新歌词样式和动画
      lyricElements.forEach((element, index) => {
        // 移除所有动画和状态类
        element.classList.remove('lyric-active', 'text-gray-300', 'text-gray-500', 'opacity-40', 'opacity-70');
        
        // 计算当前歌词与活动歌词的距离
        const distance = Math.abs(index - currentLyricIndex);
        
        // 根据位置添加不同的样式
        if (index === currentLyricIndex) {
          // 当前歌词居中高亮显示
          element.classList.add('lyric-active');
        } else if (distance === 1) {
          // 相邻歌词保持较高可见度
          element.classList.add('text-gray-300', 'opacity-70');
        } else if (distance === 2) {
          // 间隔一行的歌词可见度降低
          element.classList.add('text-gray-300', 'opacity-40');
        } else {
          // 更远的歌词保持低可见度
          element.classList.add('text-gray-500', 'opacity-40');
        }
      });
      
      // 平滑滚动到当前歌词 - 使其始终居中显示
      if (currentLyricIndex >= 0 && lyricElements[currentLyricIndex]) {
        const activeElement = lyricElements[currentLyricIndex];
        const containerHeight = lyricContainer.clientHeight;
        const elementOffsetTop = activeElement.offsetTop;
        
        // 计算目标滚动位置，使当前歌词居中
        const targetScrollTop = elementOffsetTop - (containerHeight / 2) + (lyricLineHeight / 2);
        
        // 平滑滚动到目标位置
        if (isMovingForward) {
          // 向前播放时使用自然的缓动效果
          smoothScrollTo(lyricContainer, targetScrollTop, 400, 'easeOutQuad');
        } else {
          // 向后拖动时快速定位
          smoothScrollTo(lyricContainer, targetScrollTop, 200, 'linear');
        }
        
        lastScrollTop = targetScrollTop;
      }
    }
    
    // 平滑滚动实现 - 增加多种缓动函数选择
    function smoothScrollTo(element, target, duration, easing = 'easeOutQuad') {
      const start = element.scrollTop;
      const change = target - start;
      const startTime = performance.now();
      
      // 多种缓动函数，使向上滚动更自然
      const easings = {
        linear: (t) => t,
        easeOutQuad: (t) => t * (2 - t),
        easeInOutQuad: (t) => t < 0.5 ? 2 * t * t : -1 + (4 - 2 * t) * t,
        easeOutCubic: (t) => --t * t * t + 1
      };
      
      const easingFunction = easings[easing] || easings.easeOutQuad;
      
      function animateScroll(currentTime) {
        const timeElapsed = currentTime - startTime;
        const progress = Math.min(timeElapsed / duration, 1);
        const easeProgress = easingFunction(progress);
        
        element.scrollTop = start + change * easeProgress;
        
        if (timeElapsed < duration) {
          requestAnimationFrame(animateScroll);
        }
      }
      
      requestAnimationFrame(animateScroll);
    }
    
    // 为当前歌曲加载歌词
    function loadLyricsForCurrentSong() {
      if (currentIndex < 0 || currentIndex >= songs.length) {
        lyrics = [];
        lyricElements = [];
        renderEmptyLyrics();
        return;
      }
      
      const song = songs[currentIndex];
      if (song.lyrics) {
        lyrics = song.lyrics;
        currentLyricIndex = -1;
        // 重置DOM缓存
        lyricElements = [];
        renderLyrics(false);
      } else {
        lyrics = [];
        lyricElements = [];
        renderEmptyLyrics();
      }
    }
    
    // 渲染无歌词状态
    function renderEmptyLyrics() {
      lyricContainer.innerHTML = `
        <div class="text-gray-500 space-y-2">
          <i class="fa fa-file-text-o text-2xl mb-2 block text-gray-600"></i>
          <p>暂无歌词</p>
          <p class="text-xs mt-1 text-gray-600">请为当前歌曲导入LRC歌词文件</p>
        </div>
      `;
    }
    
    // 更新播放列表UI - 添加滑动效果
    function updatePlaylistUI() {
      const oldItems = Array.from(playlist.children);
      
      // 为所有旧项添加滑出效果
      oldItems.forEach((item, index) => {
        setTimeout(() => {
          item.classList.add('slide-out');
          
          // 移除滑出的项
          setTimeout(() => {
            if (playlist.contains(item)) {
              playlist.removeChild(item);
            }
          }, 300);
        }, index * 50);
      });
      
      // 延迟添加新项以等待滑出动画完成
      setTimeout(() => {
        playlist.innerHTML = '';
        
        if (songs.length === 0) {
          playlist.innerHTML = `
            <li class="flex items-center justify-center p-8 text-gray-500 slide-in">
              <div class="text-center">
                <i class="fa fa-music text-3xl mb-3 text-primary/50"></i>
                <p>播放列表为空</p>
                <p class="text-xs mt-1">请点击上方按钮导入本地音乐</p>
              </div>
            </li>
          `;
          return;
        }
        
        songs.forEach((song, index) => {
          const li = document.createElement('li');
          li.className = `playlist-item ${index === currentIndex ? 'playlist-item-active' : ''} slide-in relative hover-lift`;
          li.style.animationDelay = `${index * 50}ms`;
          li.innerHTML = `
            <div class="absolute inset-0 bg-primary/5 rounded-lg -z-10"></div>
            <div class="w-8 text-center mr-2 text-gray-400">
              ${index === currentIndex ? 
                '<i class="fa fa-music text-primary"></i>' : 
                (index + 1)}
            </div>
            <div class="flex-1 min-w-0">
              <div class="truncate font-medium">${song.title || '未知歌曲'}</div>
              <div class="truncate text-xs text-gray-400">${song.artist || '未知艺术家'}</div>
            </div>
            <button class="delete-song text-gray-500 hover:text-secondary p-1 ml-2 opacity-0 hover:opacity-100 transition-opacity" data-index="${index}">
              <i class="fa fa-times"></i>
            </button>
          `;
          
          li.addEventListener('click', (e) => {
            // 如果点击的是删除按钮，不播放歌曲
            if (e.target.closest('.delete-song')) return;
            
            if (index !== currentIndex) {
              loadAndPlay(index);
            } else {
              togglePlayPause();
            }
          });
          
          playlist.appendChild(li);
        });
        
        // 添加删除歌曲事件监听
        document.querySelectorAll('.delete-song').forEach(button => {
          button.addEventListener('click', (e) => {
            e.stopPropagation();
            const index = parseInt(button.getAttribute('data-index'), 10);
            deleteSong(index);
          });
        });
      }, 300);
    }
    
    // 删除歌曲 - 添加滑动效果
    function deleteSong(index) {
      if (index < 0 || index >= songs.length) return;
      
      // 获取要删除的项并添加滑出效果
      const itemToRemove = playlist.children[index];
      if (itemToRemove) {
        itemToRemove.classList.add('slide-out');
      }
      
      // 延迟实际删除以显示动画
      setTimeout(() => {
        // 如果删除的是当前播放的歌曲
        const wasCurrentSong = index === currentIndex;
        
        // 从列表中移除
        songs.splice(index, 1);
        
        // 更新当前索引
        if (wasCurrentSong) {
          // 停止当前播放
          audioPlayer.pause();
          albumCover.classList.remove('album-spin');
          
          // 如果还有歌曲，播放下一首
          if (songs.length > 0) {
            const newIndex = index < songs.length ? index : songs.length - 1;
            loadAndPlay(newIndex);
          } else {
            // 没有歌曲了，重置UI
            resetPlayerUI();
          }
        } else if (index < currentIndex) {
          // 如果删除的是当前歌曲之前的歌曲，调整索引
          currentIndex--;
        }
        
        // 更新播放列表UI
        updatePlaylistUI();
        
        // 更新本地文件指示器
        updateLocalFilesIndicator();
      }, 300);
    }
    
    // 重置播放器UI
    function resetPlayerUI() {
      songTitle.textContent = '你要导入歌曲哦~';
      songArtist.textContent = '点击上方按钮开始导入本地音乐';
      currentTimeDisplay.textContent = '00:00';
      totalTimeDisplay.textContent = '00:00';
      progressBar.value = 0;
      progressFilled.style.width = '0%';
      progressHandle.style.left = '0';
      playPauseButton.innerHTML = '<i class="fa fa-play text-2xl"></i>';
      albumCover.classList.remove('album-spin');
      renderEmptyLyrics();
      
      // 禁用控制按钮
      disableControls(true);
    }
    
    // 启用/禁用控制按钮
    function disableControls(disable) {
      playPauseButton.disabled = disable;
      prevButton.disabled = disable;
      nextButton.disabled = disable;
      modeButton.disabled = disable;
      muteButton.disabled = disable;
      volumeSlider.disabled = disable;
      progressBar.disabled = disable;
      
      // 添加按钮状态变化的滑动效果
      [playPauseButton, prevButton, nextButton, modeButton, muteButton].forEach(btn => {
        if (disable) {
          btn.classList.add('opacity-50');
        } else {
          btn.classList.remove('opacity-50');
          btn.classList.add('slide-in');
          setTimeout(() => {
            btn.classList.remove('slide-in');
          }, 300);
        }
      });
    }
    
    // 更新本地文件指示器
    function updateLocalFilesIndicator() {
      hasLocalFiles = songs.length > 0;
      localFilesIndicator.classList.toggle('hidden', !hasLocalFiles);
      
      // 添加指示器显示/隐藏的滑动效果
      if (hasLocalFiles) {
        localFilesIndicator.classList.add('slide-in');
        setTimeout(() => {
          localFilesIndicator.classList.remove('slide-in');
        }, 300);
      }
    }
    
    // 处理音频文件导入
    function handleAudioImport(event) {
      const files = event.target.files;
      if (!files || files.length === 0) return;
      
      for (const file of files) {
        // 只处理音频文件
        if (!file.type.startsWith('audio/')) continue;
        
        // 创建文件URL
        const url = URL.createObjectURL(file);
        
        // 解析文件名（去掉扩展名）
        let fileName = file.name;
        const extIndex = fileName.lastIndexOf('.');
        if (extIndex !== -1) {
          fileName = fileName.substring(0, extIndex);
        }
        
        // 尝试从文件名解析歌手和歌曲名（格式：歌手 - 歌曲名）
        let artist = '未知艺术家';
        let title = fileName;
        const separatorIndex = fileName.indexOf(' - ');
        if (separatorIndex !== -1) {
          artist = fileName.substring(0, separatorIndex);
          title = fileName.substring(separatorIndex + 3);
        }
        
        // 添加到歌曲列表
        songs.push({
          url,
          title,
          artist,
          file,
          lyrics: null
        });
      }
      
      // 更新播放列表
      updatePlaylistUI();
      
      // 更新本地文件指示器
      updateLocalFilesIndicator();
      
      // 启用控制按钮
      disableControls(false);
      
      // 如果是首次导入，自动播放第一首
      if (currentIndex === -1 && songs.length > 0) {
        loadAndPlay(0);
      }
      
      // 清空文件输入，允许重复选择同一文件
      audioImport.value = '';
    }
    
    // 处理歌词文件导入
    function handleLyricImport(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // 检查是否有正在播放的歌曲
      if (currentIndex === -1 || songs.length === 0) {
        alert('请先导入并播放一首歌曲');
        lyricImport.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const lrcText = e.target.result;
          const parsedLyrics = parseLyrics(lrcText);
          
          if (parsedLyrics.length > 0) {
            // 保存歌词到当前歌曲
            songs[currentIndex].lyrics = parsedLyrics;
            lyrics = parsedLyrics;
            currentLyricIndex = -1;
            // 重置DOM缓存
            lyricElements = [];
            renderLyrics(false);
            
            // 歌词导入成功的滑动提示效果
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-primary text-white px-4 py-2 rounded-lg shadow-lg slide-in z-50';
            notification.textContent = '歌词导入成功';
            document.body.appendChild(notification);
            
            setTimeout(() => {
              notification.classList.add('slide-out');
              setTimeout(() => {
                document.body.removeChild(notification);
              }, 300);
            }, 2000);
          } else {
            alert('未解析到有效的歌词');
          }
        } catch (error) {
          console.error('解析歌词失败:', error);
          alert('解析歌词失败，请检查文件格式');
        }
      };
      
      reader.readAsText(file, 'utf-8');
      
      // 清空文件输入
      lyricImport.value = '';
    }
    
    // 事件监听
    playPauseButton.addEventListener('click', togglePlayPause);
    prevButton.addEventListener('click', playPrevious);
    nextButton.addEventListener('click', playNext);
    modeButton.addEventListener('click', togglePlayMode);
    muteButton.addEventListener('click', toggleMute);
    volumeSlider.addEventListener('input', updateVolume);
    progressBar.addEventListener('mousedown', handleProgressDragStart);
    progressBar.addEventListener('input', handleProgressDragging);
    progressBar.addEventListener('mouseup', handleProgressDragEnd);
    progressBar.addEventListener('mouseleave', handleProgressDragEnd);
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('loadedmetadata', updateTotalTime);
    audioPlayer.addEventListener('ended', () => {
      if (playMode === 1) { // 单曲循环
        audioPlayer.currentTime = 0;
        audioPlayer.play();
      } else { // 顺序播放或随机播放
        playNext();
      }
    });
    audioImport.addEventListener('change', handleAudioImport);
    lyricImport.addEventListener('change', handleLyricImport);
    albumCoverContainer.addEventListener('click', togglePlayPause);
    
    // 初始化进度条
    progressFilled.style.width = '0%';
    progressHandle.style.left = '0';
    
    // 初始化
    updateModeUI();
    updateVolume();
  </script>

</body></html>